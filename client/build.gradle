
task build() {
    // Maybe inputs.file too simple for incremental build,
    // but it should work well in most cases. At least only
    // excessive builds possible.
    inputs.file projectDir
    // Output for production will be in 'prod' folder. Output
    // for react hot redeploy server was set to 'dev' folder.
    // In fact it never create this folder but for clarity
    // we configure separated folders for dev and production
    // mode
    def prodOutDir = "$buildDir/prod"
    outputs.dir prodOutDir
    doLast {
        // webpack will be invoked with "npm run build" and
        // resulting bundle.js will be saved to build folder
        // by webpack itself (see webpack.config.js)
        exec {
            commandLine "npm", "install"
        }
        exec {
            commandLine "npm", "run", "build"
        }
        if (!new File("$prodOutDir/bundle.js").exists()) {
            throw new GradleException("$prodOutDir/bundle.js is not created")
        }
        // As we want to have full frontend distribution in
        // build folder let's copy index.html
        copy {
            from "src/index.html"
            into prodOutDir
        }
    }
}

task clean(type: Delete) {
    delete buildDir
}