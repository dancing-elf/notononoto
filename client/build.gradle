
task build() {
    // Maybe inputs.file too simple for incremental build,
    // but it should work well in most cases. At least only
    // excessive builds possible.
    inputs.file projectDir
    outputs.dir buildDir
    doLast {
        // webpack will be invoked with "npm run build" and
        // resulting bundle.js will be saved to build folder
        // by webpack itself (see webpack.config.js)
        exec {
            commandLine "npm", "install"
        }
        exec {
            commandLine "npm", "run", "build"
        }
        if (!new File("$buildDir/bundle.js").exists()) {
            throw new GradleException("bundle.js is not created")
        }
        // As we want to have full frontend distribution in
        // build folder let's copy index.html
        copy {
            from "src/index.html"
            into buildDir
        }
    }
}

task clean(type: Delete) {
    delete buildDir
}